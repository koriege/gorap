###########
# GORAP 2 #
###########

1   INSTALLATION
2   UPDATE GORAP
2.1 UPDATE LIBRARY
2.2 UPDATE DATABASES
3   RUNNING GORAP
4	RESULTS
5   KNOWN ISSUES AND SOLUTIONS
6   MISSING STUFF
7	CONTACT

--------------
1 INSTALLATION
--------------

1) Set the GORAP variable, assigned to its installation directory
export GORAP=/path/to/install/dir
2) store the GORAP variable permanently to ensure that Gorap can always find the required tools
echo "export GORAP=$GORAP" >> ~/.bashrc
3) Download Gorap
git clone --recursive https://github.com/rna-hta-jena/gorap.git
4) Enter the source directory
cd gorap
5) Checkout latest stable version
git checkout $(git describe --tags)
6) Install Gorap and all necessary tools
./setup -i all

--------------
2 UPDATE GORAP
--------------

2.1 UPDATE LIBRARY

1) Follow the INSTALLATION steps 3 to 5
2) Update Gorap
./setup -i update

2.3 UPDATE DATABASES

# Info
In case of updating to a newer Rfam release, you need to correct manually defined family specific configuration constrains.
Therefore, please check the ERROR output and shift also the pre-annotated CD-box snoRNA constrains matching again: 
- the C-box motif UGAUGA
- the D-box motif CUGA
Example:
conserved=uuGCAAUGAUGuUAagAAUUUCUUcacCUGAAuuaaaCcuUGAaGuucAAAaauCGAGCUUUUUAACaCUGAGCaaa
constrain=.....|..1...|......................................................|.1..|....
constrain=......|0.|...........................................................|0.|....

# Update all databases
$GORAP/bin/gorap/Gorap.pl -update all

# Or update single databases
$GORAP/bin/gorap/Gorap.pl -update rfam
$GORAP/bin/gorap/Gorap.pl -update ncbi
$GORAP/bin/gorap/Gorap.pl -update silva

---------------
3 RUNNING GORAP
---------------

#Info
Hint 1: Multiple (not parallel) runs can be saved into the same output directory
Hint 2: Restart a run with same parameters, adding -skip, skips annotation
-> but enables additional computations like sorting and phylogeny reconstruction
Hint 3: Command line parameters priorize parameter file settings
-> e.g. call Gorap.pl -file parameter.txt -skip -sort -l new_label
Hint 4: For each Rfam model in $GORAP/config exists specific configuration files
-> Optionally set thresholds, other prediction tools and sequence mismatch constrains here
-> see an exmample here: $GORAP/config/RF00016_SNORD14.cfg 
-> Create an own covariance model and similar configuration file to screen for new families

# Run GORAP using a parameter file - see example parameter file for available options
$GORAP/bin/gorap/Gorap.pl -file parameter.txt

# Run GORAP using command line parameters
$GORAP/bin/gorap/Gorap.pl Gorap.pl -c 8 -i $GORAP/bin/gorap/example/ecoli.fa -a ecol -k bac -s 562 -r 543 -g $GORAP/bin/gorap/example/ecoli.gff

# Run GORAP without taxonomy filter and reading of NCBI Taxonomy even if -s or -r are used
perl Gorap.pl -notax -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac	-s 562 -r 543

# Screen for a subset of families: ids 1 to 5, 8 and all greater equals 100
perl Gorap.pl -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac -q 1:5,8,100:
  
# Example of annotation and SSU/RNome phylogeny reconstruction in one step. 
# A given outgroup will be screened only for families present in genome files given by -i
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -og <FASTA>
  
# 3-Step Phylogeny reconstruction from a full annotation after hand curated alignments
# we recommend to use a defined label to update related HTML page displaying results
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -l myphylo
# Evaluate alignments by removing/adding sequences and now update annotation files
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -refresh -l myphylo
# Skip the annotation process, but do downstream analysis i.e. phylogeny reconstruction
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA> -og <FASTA> -k bac -skip -l myphylo

# De-novo prediction and TPM/FPKM calculation from (small-)RNA-Seq experiments
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA> -k bac -b <BAM>,<BAM> 
-> very (!) experimental and still under construction

---------
4 RESULTS
---------

annotations: contains ncRNA predictions in GFF3 and FASTA format
	*orig - files with original sequence ids 
	*final - files with predictions passing all filter steps
	GFF tags of filtered, unreliable sequences: 
		L - Length cutoff if predicted sequence is shorter than 40% of conserved Rfam sequence
		B - Bitscore threshold of lowest score of taxonomic related species in Rfam 
			or as suggested by Rfam for family model, lowered by 10%, applied for non CD-snoRNAs
		S - Structure based rejection, if less than 50% of conserved hairpins are present
		P - Primary sequence conservation based rejection, if less than 70% bases are present
			of conserved bases in 90% of Rfam sequences
			Exception: CD-snoRNAs - which are screened for special properties and appropriate 
			box motifs as manually predefined in Rfam model specific configuration files
		C - Copy number cutoff as defined in model specific configuration files
		O - Overlap based rejection if previous, higher scoring annotation exists or is provided
		X - Tag of manually deleted sequences from alignments after Gorap.pl -refresh call
		! - Final tag - all filters passed
alignments: contains Stockholm alignments of final predictions for all screened Rfam models
meta: contains Stockholm alignments of each filter step - see GFF tags
phylogeny: containes reconstructed phylogenies of given species based on
	RNome - all ncRNA predictions except rRNAs and tRNAs, using a super-matrix approach
	core50RNome - ncRNA predictions, present in 50% of given species and except rRNAs and tRNAs,
		using a super-matrix approach
	coreRNome STK - ncRNAs present in all species, built from concatenated Stockholm alignments
	coreRNome MAFFT - ncRNAs present in all species, built by Mafft from concatenated FASTA sequences
html: contains labeled html files linking to related results, accessible via main index.html web page


----------------------------
4 KNOWN ISSUES AND SOLUTIONS
----------------------------

GORAP dies due to a Blast bug, if FASTA headers have NCBI typical accession numbers somewhere inside
>something gi|00000000|ref|NC_000000.0| something else
Transform headers into 
>gi|00000000|ref|NC_000000.0| something else
by executing

sed -i'' -e 's/^>\S*\s*/>/' file.fasta


---------------
5 MISSING STUFF
---------------

Suggestions? Bugs? Troubles? Please let me know!


---------
6 CONTACT
---------

Konstantin Riege
Chair of Bioinformatics
High Throughput Analysis
Friedrich-Schiller-University Jena
http://www.rna.uni-jena.de
konstantin{.}riege{a}uni-jena{.}de
