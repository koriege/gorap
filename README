###########
# GORAP 2 #
###########

1   INSTALLATION
1.1 INFORMATION
1.2 INSTALLATION
1.3 HIGHLY RECOMMENDED POST INSTALLATION
2   UPDATE GORAP
2.1 UPDATE GORAP LIBRARY
2.2 UPDATE GORAP TOOLS
2.3 UPDATE GORAP DATABASES
3   RUNNING GORAP
4   KNOWN ISSUES AND SOLUTIONS
5   MISSING STUFF
6	CONTACT

--------------
1 INSTALLATION
--------------

1.1 INFORAMTION

GORAP will be installed in the following directory, which can be changed
during the INSTALLATION step: $HOME/gorap

GORAP requires some Perl modules. By default missing ones will be installed 
into a conventional shared perl5 directory in your home. These modules can 
be used by other Perl scripts automatically, too and changed during the
INSTALLATION step: $HOME/perl5

1.2 INSTALLATION

# Set the two following directories, which can be changed
export GORAP=$HOME/gorap
export GORAPLIB=$HOME/perl5	
# Update the Perl library path
export PERL5LIB=$GORAPLIB/lib/perl5:$PERL5LIB
# Update the binaries path to make GORAP available globally
export PATH=$GORAP:$PATH
# Download latest GORAP library
wget https://github.com/rna-hta-jena/gorap/archive/master.zip
# Extract library
unzip master.zip
# Enter extracted directory
cd gorap-master
# Download and local installation of missing software into $GORAP
bash install_tools.sh
# Download corresponding databases
wget www.rna.uni-jena.de/supplements/gorap/data-12.tar.gz
# Extract databases into $GORAP
tar -xzf data-12.tar.gz -C $GORAP/
# Set path to necessary and always downloaded Samtools software
export SAMTOOLS=$GORAP/samtools-0.1.19
# Installation of GORAP and latest required Perl modules
./cpanm -l $GORAPLIB . --force
# Mute BioPerl warnings (to restore changes execute: bash nowarnings.sh off)
bash nowarnings.sh on
# Copy all scripts to the $GORAP directory
cp *.pl $GORAP	
# you are done - go rapping!


1.3 HIGHLY RECOMMENDED POST INSTALLATION

# To use GORAP later from command line again and to be able to update it, you
# can redo the PREPARATION or store the installation paths permanent this way.
echo 'export PATH=$PATH:'$GORAP >> $HOME/.bashrc
echo 'export GORAP='$GORAP >> $HOME/.bashrc
echo 'export PERL5LIB='$PERL5LIB >> $HOME/.bashrc


--------------
2 UPDATE GORAP
--------------

2.1 UPDATE GORAP LIBRARY

# wget does not overwrite an existing master.zip file
wget https://github.com/rna-hta-jena/gorap/archive/master.zip
unzip master.zip
cd gorap-master
# make sure to have $GORAP and $GORAPLIB exported first/permanent
./cpanm -l $GORAPLIB --reinstall .
cp *.pl $GORAP


2.2 UPDATE GORAP TOOLS

# wget does not overwrite an existing master.zip file
wget https://github.com/rna-hta-jena/gorap/archive/master.zip
unzip master.zip
cd gorap-master
bash install_tools.sh

2.3 UPDATE GORAP DATABASES

# Update all databases or in single by typing silva, ncbi, rfam or cfg instead
perl Gorap.pl -update all


---------------
3 RUNNING GORAP
---------------

# hint 1: Multiple runs can be saved into the same output directory
# hint 2: Restart a run with same parameters, but -q 0 skips annotation, but does additional computations
# hint 3: Command line parameters are priorized over parameter file settings

# Run GORAP using a parameter file 
perl Gorap.pl -file $GORAP/parameter/parameter.txt

# Run GORAP using command line parameters
perl Gorap.pl -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac -s 562 -r 543 -b $GORAP/example/ecoli.bam

# Run GORAP without time consuming reading of NCBI Taxonomy if -s and -r are not used
perl Gorap.pl -notax -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac	

# Screen for a subset of families: ids 1 to 5, 8 and all greater equals 100
perl Gorap.pl -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac -q 1:5,8,100:
  
# Example of annotation and SSU/RNome phylogeny reconstruction in one step. 
# A given outgroup will be screened only for families predicted in input files (-i)
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -og <FASTA>
  
# Phylogeny reconstruction from a full annotation and after hand curation
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac
# Evaluate alignments and update annotation files
perl RefreshOutput.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac	
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA> -og <FASTA> -k bac -q 0

# Adding FPKM value from a BAM files to a previous run or after hand curation
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA> -k bac -b <BAM>,<BAM> -q 0


----------------------------
4 KNOWN ISSUES AND SOLUTIONS
----------------------------

# GORAP dies due to a Blast bug, if FASTA headers have NCBI typic accession numbers somewhere inside
# >something gi|00000000|ref|NC_000000.0| something else
# Transform headers into 
# >gi|00000000|ref|NC_000000.0| something else
# by executing
sed -i 's/^>[[:graph:]]*[[:space:]]*/>/' file.fasta


---------------
5 MISSING STUFF
---------------

Suggestions? Please let me know :)


---------
6 CONTACT
---------

Konstantin Riege
Chair of Bioinformatics
High Throughput Analysis
Friedrich-Schiller-University Jena
http://www.rna.uni-jena.de
konstantin{.}riege{a}uni-jena{.}de