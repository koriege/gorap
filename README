###########
# GORAP 2 #
###########

1   INSTALLATION
1.1 INFORMATION
1.2 INSTALLATION
1.3 HIGHLY RECOMMENDED POST INSTALLATION
2   UPDATE GORAP
2.1 UPDATE GORAP LIBRARY
2.2 UPDATE GORAP TOOLS
2.3 UPDATE GORAP DATABASES
3   RUNNING GORAP
4   KNOWN ISSUES AND SOLUTIONS
5   MISSING STUFF
6	CONTACT

--------------
1 INSTALLATION
--------------

1.1 INFORAMTION

We also provide a pre-compiled, operating system independent version based on Docker
see http://www.rna.uni-jena.de/en/software/

--

GORAP will be installed in the following directory, which can be changed
during the INSTALLATION step: $HOME/gorap

GORAP requires some Perl modules. By default missing ones will be installed 
into a conventional, shared perl5 directory in your home. These modules can 
be used by other Perl scripts, too. The location can be changed during the
INSTALLATION step: $HOME/perl5

1.2 INSTALLATION

# Set the two following directories, which can be changed here
export GORAP=$HOME/gorap
export GORAPLIB=$HOME/perl5	
# Update the Perl library path
export PERL5LIB=$GORAPLIB/lib/perl5:$PERL5LIB
# Update the binaries path to make GORAP available globally
export PATH=$GORAP:$PATH
# Download GORAP latest
wget https://github.com/rna-hta-jena/gorap/archive/master.zip -O master.zip
# Extract GORAP
unzip master.zip
# Enter extracted directory
cd gorap-master
# Download corresponding databases
wget www.rna.uni-jena.de/supplements/gorap/data-12.tar.gz -O data-12.tar.gz
# Extract databases into $GORAP
tar -xzf data-12.tar.gz -C $GORAP/
# Download and local installation of missing software into $GORAP
bash install_tools.sh
# Set path to necessary and always downloaded Samtools software
export SAMTOOLS=$GORAP/samtools-0.1.19
# Installation of GORAP and latest required Perl modules
wget https://cpanmin.us -O cpanm && chmod 755 cpanm
./cpanm -l $GORAPLIB .
# Mute BioPerl warnings (to restore changes execute: bash nowarnings.sh off)
bash nowarnings.sh on
# Copy all scripts to the $GORAP directory
cp *.pl $GORAP	
# you are done - go rapping!


1.3 HIGHLY RECOMMENDED POST INSTALLATION

# To use GORAP later from command line again and to be able to update it, you
# can redo all exports from INSTALLATION or store them permanently this way.
echo 'export PATH=$PATH:'$GORAP >> $HOME/.bashrc
echo 'export GORAP='$GORAP >> $HOME/.bashrc
echo 'export PERL5LIB='$PERL5LIB >> $HOME/.bashrc


--------------
2 UPDATE GORAP
--------------

2.1 UPDATE GORAP LIBRARY
wget https://github.com/rna-hta-jena/gorap/archive/master.zip -O master.zip
unzip master.zip
cd gorap-master
# make sure to have $GORAP and $GORAPLIB exported first/permanent
wget https://cpanmin.us -O cpanm && chmod 755 cpanm
./cpanm -l $GORAPLIB --reinstall .
cp *.pl $GORAP


2.2 UPDATE GORAP TOOLS

wget https://github.com/rna-hta-jena/gorap/archive/master.zip -O master.zip
unzip master.zip
cd gorap-master
bash install_tools.sh

2.3 UPDATE GORAP DATABASES

# Update all databases or in single by typing silva, ncbi, rfam or cfg instead
perl Gorap.pl -update all


---------------
3 RUNNING GORAP
---------------

# hint 1: Multiple (not parallel) runs can be saved into the same output directory
# hint 2: Restart a run with same parameters, adding -skip, skips annotation
# -> but enables additional computations like sorting and phylogeny reconstruction
# hint 3: Command line parameters priorize parameter file settings
# -> e.g. call Gorap.pl -file parameter.txt -skip -sort -l new_label

# Run GORAP using a parameter file - see example parameter file for available options
perl Gorap.pl -file parameter.txt

# Run GORAP using command line parameters
perl Gorap.pl -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac -s 562 -r 543 -g $GORAP/example/ecoli.gff

# Run GORAP without taxonomy filter and reading of NCBI Taxonomy even if -s or -r are used
perl Gorap.pl -notax -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac	-s 562 -r 543

# Screen for a subset of families: ids 1 to 5, 8 and all greater equals 100
perl Gorap.pl -c 8 -i $GORAP/example/ecoli.fa -a ecol -k bac -q 1:5,8,100:
  
# Example of annotation and SSU/RNome phylogeny reconstruction in one step. 
# A given outgroup will be screened only for families present in genome files given by -i
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -og <FASTA>
  
# 3-Step Phylogeny reconstruction from a full annotation after hand curating alignments
# we recommend to use a defined label to update related HTML page displaying results
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -l myphylo
# Evaluate alignments by removing/adding seqeunces and now update annotation files
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA>,<FASTA> -k bac -refresh -l myphylo
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA> -og <FASTA> -k bac -skip -l myphylo

# Calculating TPM/FPKM value from BAM files to a previous run or after hand curation
perl Gorap.pl -i <FASTA>,<FASTA>,<FASTA> -k bac -b <BAM>,<BAM> -skip


----------------------------
4 KNOWN ISSUES AND SOLUTIONS
----------------------------

# GORAP dies due to a Blast bug, if FASTA headers have NCBI typic accession numbers somewhere inside
# >something gi|00000000|ref|NC_000000.0| something else
# Transform headers into 
# >gi|00000000|ref|NC_000000.0| something else
# by executing
sed -iE 's/^>\S*\s*/>/' file.fasta


---------------
5 MISSING STUFF
---------------

Suggestions? Bugs? Please let me know :)


---------
6 CONTACT
---------

Konstantin Riege
Chair of Bioinformatics
High Throughput Analysis
Friedrich-Schiller-University Jena
http://www.rna.uni-jena.de
konstantin{.}riege{a}uni-jena{.}de
